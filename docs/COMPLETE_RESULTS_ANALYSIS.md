# å®Œæ•´ç»“æœåˆ†æä¸æ¨¡å‹ä¼˜åŒ–å»ºè®®

**ç”Ÿæˆæ—¶é—´**: 2025-10-09
**æ€»å®éªŒæ•°**: 13æ¬¡å®Œæ•´è®­ç»ƒ
**æœ€ä½³Val F-Score**: 0.6889 (å¯ä¿¡) / 0.6958 (å­˜ç–‘)

---

## ğŸ“Š æ‰€æœ‰å®éªŒç»“æœæ’å

| Rank | Val F-Score | Epoch | Total | Checkpoint | å¤‡æ³¨ |
|------|-------------|-------|-------|------------|------|
| ğŸ¥‡ 1 | **0.6958** | 3 | 33 | microsegformer_20251009_172335 | âš ï¸ Continueè®­ç»ƒï¼ŒEpoch 3å¯èƒ½æ˜¯å™ªå£° |
| ğŸ¥ˆ 2 | **0.6889** | 92 | 112 | microsegformer_20251008_025917 | âœ… Dice=1.5ï¼Œç¨³å®šæœ€ä½³ |
| ğŸ¥‰ 3 | **0.6819** | 80 | 100 | microsegformer_20251007_153857 | âœ… Dice=1.0 baselineï¼ŒTest=0.72 |
| 4 | 0.6769 | 75 | 95 | microsegformer_20251008_030003 | Strong Augï¼Œæ•ˆæœå˜å·® |
| 5 | 0.6753 | 124 | 144 | microsegformer_20251006_132005 | æ—©æœŸå®éªŒ |
| 6 | 0.6736 | 128 | 148 | microsegformer_20251007_211559 | æ—©æœŸå®éªŒ |
| 7 | 0.6702 | 78 | 98 | microsegformer_20251007_211515 | æ—©æœŸå®éªŒ |
| 8 | 0.6664 | 74 | 94 | microsegformer_20251007_224140 | æ—©æœŸå®éªŒ |
| 9 | 0.6546 | 97 | 117 | microsegformer_20251006_110635 | æ—©æœŸå®éªŒ |
| 10 | 0.6483 | 99 | 119 | microsegformer_20251005_204126 | æ—©æœŸå®éªŒ |

---

## ğŸ”¬ å…³é”®å‘ç°

### 1. æŸå¤±å‡½æ•°æƒé‡æ˜¯æœ€å…³é”®å› ç´ 

| Dice Weight | Val F-Score | æå‡ | ç»“è®º |
|-------------|-------------|------|------|
| 1.0 | 0.6819 | baseline | Baseline |
| 1.5 | 0.6889 | +1.02% | âœ… æ˜¾è‘—æå‡ |
| 2.0 | TBD | ? | ğŸ”¬ å¾…æµ‹è¯• |
| 2.5 | TBD | ? | ğŸ”¬ å¾…æµ‹è¯• |

**ç»“è®º**:
- Dice weightä»1.0â†’1.5å¸¦æ¥+1.02%æå‡
- **è¿™æ˜¯å•å‚æ•°è°ƒæ•´å¸¦æ¥çš„æœ€å¤§æ”¶ç›Š**
- Dice 2.0å’Œ2.5çš„æµ‹è¯•è‡³å…³é‡è¦

---

### 2. æ•°æ®å¢å¼ºï¼šæ›´å¼ºâ‰ æ›´å¥½

| é…ç½® | Rotation | Color Jitter | Val F-Score | ç»“è®º |
|------|----------|--------------|-------------|------|
| Baseline | 15Â° | 0.2 | 0.6819 | âœ… æœ€ä¼˜ |
| Strong Aug | 20Â° | 0.3 | 0.6769 | âŒ -0.5% |

**ç»“è®º**:
- è¿‡åº¦å¢å¼ºï¼ˆrotation 20Â°, color jitter 0.3ï¼‰åè€Œé™ä½æ€§èƒ½
- Face parsingéœ€è¦ä¿æŒé¢éƒ¨ç»“æ„å®Œæ•´æ€§
- **å½“å‰å¢å¼ºé…ç½®å·²ç»æ˜¯æœ€ä¼˜ï¼Œä¸è¦æ”¹åŠ¨**

---

### 3. Continueè®­ç»ƒçš„é™·é˜±

**Checkpoint**: microsegformer_20251009_172335 (0.6958)

**é—®é¢˜åˆ†æ**:
```
Epoch 1:  0.6530 (-3.59% from 0.6889) â† é‡ç½®optimizerå¯¼è‡´æ€§èƒ½æš´è·Œ
Epoch 3:  0.6958 (+0.69% from 0.6889) â† éšæœºæ³¢åŠ¨ï¼Œä¸æ˜¯çœŸå®æå‡
Epoch 33: 0.6670 (-2.19% from 0.6889) â† è¿‡æ‹Ÿåˆï¼Œæœ€ç»ˆæ›´å·®
```

**ç»“è®º**:
- Epoch 3çš„0.6958æ˜¯**å‡è±¡**ï¼Œä¸å¯ä¿¡
- ç»§ç»­è®­ç»ƒéœ€è¦æä½å­¦ä¹ ç‡(5e-6)æˆ–ä¿ç•™optimizerçŠ¶æ€
- **çœŸå®æœ€ä½³æ¨¡å‹ä»æ˜¯0.6889**

---

### 4. Test Setæ³›åŒ–æ¨¡å¼

**å”¯ä¸€æäº¤è®°å½•**:
- Val F-Score: 0.6819
- Test F-Score: **0.72**
- Gap: **+5.6%** (testæ¯”validationæ›´å¥½ï¼)

**æ¨æµ‹**:
- 0.6889æ¨¡å‹é¢„æœŸTeståˆ†æ•°: **0.73-0.74**
- å¦‚æœDice 2.5èƒ½è¾¾åˆ°Val 0.70ï¼Œåˆ™Testå¯èƒ½: **0.74-0.75**

---

## ğŸ¤” æ˜¯å¦éœ€è¦æ¨¡å‹å±‚é¢ä¼˜åŒ–ï¼Ÿ

### å½“å‰æ¨¡å‹æ¶æ„ï¼šMicroSegFormer + LMSA

**ç»„ä»¶**:
1. **Encoder**: MobileNetV2 backbone (pretrained)
2. **Decoder**: Lightweight decoder with skip connections
3. **LMSA**: Lightweight Multi-Scale Attention module
4. **Total Params**: 1,747,923 (96.0% of 1,821,085 limit)

### åˆ†æï¼šæ¨¡å‹ä¼˜åŒ–ç©ºé—´

#### âœ… å·²ç»å¾ˆå¥½çš„éƒ¨åˆ†

1. **å‚æ•°æ•ˆç‡**: 96%å‚æ•°åˆ©ç”¨ç‡ï¼Œæ¥è¿‘ä¸Šé™
2. **æ¶æ„è®¾è®¡**: LMSAä¸“ä¸ºå°ç›®æ ‡è®¾è®¡ï¼Œæœ‰æ•ˆ
3. **Skip connections**: ä¿ç•™ç»†èŠ‚ä¿¡æ¯
4. **Pretrained backbone**: MobileNetV2 ImageNeté¢„è®­ç»ƒ

#### âš ï¸ å¯èƒ½çš„æ”¹è¿›ç‚¹

| ä¼˜åŒ–æ–¹å‘ | é¢„æœŸæå‡ | å®æ–½éš¾åº¦ | é£é™© | æ¨èåº¦ |
|---------|---------|---------|------|--------|
| **1. å¢åŠ Decoderæ·±åº¦** | +0.3-0.5% | ä¸­ | å‚æ•°è¶…é™ | â­â­ |
| **2. Multi-head LMSA** | +0.5-1.0% | é«˜ | å¤æ‚åº¦é«˜ | â­â­â­ |
| **3. Edge Enhancementæ¨¡å—** | +0.2-0.4% | ä¸­ | è½»å¾®è¿‡æ‹Ÿåˆ | â­â­ |
| **4. Auxiliary Loss (å¤šå°ºåº¦ç›‘ç£)** | +0.3-0.6% | ä½ | è®­ç»ƒä¸ç¨³å®š | â­â­â­â­ |
| **5. Attention Refinement** | +0.4-0.8% | é«˜ | å‚æ•°å¢åŠ  | â­â­â­ |

---

## ğŸ¯ æ¨èç­–ç•¥

### ç­–ç•¥1ï¼šä¼˜å…ˆå®ŒæˆLosså®éªŒï¼ˆæ¨èâ­â­â­â­â­ï¼‰

**ç†ç”±**:
- Dice 1.0â†’1.5å·²éªŒè¯+1.02%æå‡
- Dice 2.0/2.5æ½œåŠ›å·¨å¤§ï¼Œå¯èƒ½å†+0.5-1.5%
- **å®æ–½æˆæœ¬å‡ ä¹ä¸º0** (åªæ”¹é…ç½®)
- é£é™©æä½

**è¡ŒåŠ¨**:
```bash
# å·²å‡†å¤‡å¥½çš„é…ç½®
python main.py --config configs/lmsa_dice2.5_aggressive.yaml
python main.py --config configs/lmsa_dice2.0_fresh.yaml
```

**é¢„æœŸ**:
- Dice 2.0: Val 0.690-0.695 (+0.1-0.6%)
- Dice 2.5: Val 0.693-0.700 (+0.4-1.1%)

---

### ç­–ç•¥2ï¼šæ¨¡å‹æ¶æ„ä¼˜åŒ–ï¼ˆå¯é€‰â­â­â­ï¼‰

**ä»…åœ¨Lossä¼˜åŒ–è¾¾åˆ°ç“¶é¢ˆåè€ƒè™‘**

#### ä¼˜åŒ–æ–¹æ¡ˆA: Auxiliary Loss (ä½é£é™©)

**å®ç°**:
```python
# åœ¨decoderçš„å¤šä¸ªå±‚çº§æ·»åŠ è¾…åŠ©è¾“å‡º
aux_outputs = []
for i, layer in enumerate(decoder_layers):
    if i in [1, 2, 3]:  # å¤šä¸ªå±‚çº§
        aux_out = self.aux_head(layer)
        aux_outputs.append(aux_out)

# æ€»loss = main_loss + 0.4 * aux_loss_1 + 0.3 * aux_loss_2 + 0.2 * aux_loss_3
```

**ä¼˜ç‚¹**:
- ä¸å¢åŠ æ¨ç†æ—¶å‚æ•°
- è®­ç»ƒæ—¶æä¾›å¤šå°ºåº¦ç›‘ç£
- å¸®åŠ©å°ç›®æ ‡å­¦ä¹ 

**é¢„æœŸ**: +0.3-0.6%

---

#### ä¼˜åŒ–æ–¹æ¡ˆB: LMSAå¢å¼º (ä¸­ç­‰é£é™©)

**å½“å‰LMSA**:
```python
# Single-head attention
attention = softmax(Q @ K.T / sqrt(d)) @ V
```

**æ”¹è¿›ä¸ºMulti-head**:
```python
# Multi-head attention (2-3 heads)
for i in range(num_heads):
    head_i = attention_head(Q_i, K_i, V_i)
output = concat([head_1, head_2, head_3]) @ W_o
```

**ä¼˜ç‚¹**:
- æ›´ä¸°å¯Œçš„ç‰¹å¾è¡¨è¾¾
- å¤šä¸ªæ³¨æ„åŠ›è§†è§’

**ç¼ºç‚¹**:
- å‚æ•°å¢åŠ çº¦20K (ä»åœ¨é™åˆ¶å†…)
- è®­ç»ƒæ—¶é—´+15%

**é¢„æœŸ**: +0.5-1.0%

---

#### ä¼˜åŒ–æ–¹æ¡ˆC: Edge-Aware Module (ä½-ä¸­é£é™©)

**åŠ¨æœº**: Face parsingè¾¹ç•Œç²¾åº¦è‡³å…³é‡è¦

**å®ç°**:
```python
# Edge detection branch
edge_map = sobel_filter(image)
edge_features = edge_encoder(edge_map)

# Fuse with segmentation features
fused = seg_features + alpha * edge_features
output = decoder(fused)
```

**ä¼˜ç‚¹**:
- æ˜¾å¼å»ºæ¨¡è¾¹ç•Œä¿¡æ¯
- å¯¹çœ¼ç›ã€å˜´å·´ç­‰å°ç›®æ ‡è¾¹ç•Œæœ‰å¸®åŠ©

**é¢„æœŸ**: +0.2-0.4%

---

## ğŸ“‹ å®Œæ•´æ‰§è¡Œè®¡åˆ’

### Phase 1: Lossä¼˜åŒ–å®Œæˆ (ä¼˜å…ˆçº§â­â­â­â­â­)

**æ—¶é—´**: 2-3å¤© (æœåŠ¡å™¨è®­ç»ƒ)
**æˆæœ¬**: GPUæ—¶é—´çº¦8-12å°æ—¶
**é¢„æœŸæ”¶ç›Š**: +0.5-1.5%

**ä»»åŠ¡**:
1. âœ… Dice 2.5è®­ç»ƒ (configs/lmsa_dice2.5_aggressive.yaml)
2. âœ… Dice 2.0è®­ç»ƒ (configs/lmsa_dice2.0_fresh.yaml)
3. åˆ†æç»“æœï¼Œç¡®å®šæœ€ä¼˜Dice weight
4. æäº¤æœ€ä½³æ¨¡å‹åˆ°Codabench

**å†³ç­–ç‚¹**:
- å¦‚æœDice 2.5è¾¾åˆ°Val 0.70+ â†’ æ»¡è¶³ç›®æ ‡ï¼Œå¯ä»¥åœæ­¢
- å¦‚æœDice 2.5ä»…è¾¾åˆ°Val 0.69 â†’ è€ƒè™‘Phase 2

---

### Phase 2: æ¨¡å‹ä¼˜åŒ– (å¯é€‰ï¼Œè§†Phase 1ç»“æœ)

**å‰ç½®æ¡ä»¶**: Phase 1å®Œæˆä¸”Val F-Score < 0.70

**ä¼˜å…ˆå­ä»»åŠ¡**:
1. **Auxiliary Loss** (æœ€ç®€å•ï¼Œ3å°æ—¶å®ç°)
   - é¢„æœŸ: +0.3-0.6%
   - é£é™©: ä½

2. **Multi-head LMSA** (1å¤©å®ç°)
   - é¢„æœŸ: +0.5-1.0%
   - é£é™©: ä¸­

3. **Edge-Aware Module** (6å°æ—¶å®ç°)
   - é¢„æœŸ: +0.2-0.4%
   - é£é™©: ä½-ä¸­

**ç»„åˆé¢„æœŸ**:
- Singleä¼˜åŒ–: +0.3-1.0%
- ç»„åˆä¼˜åŒ–: +0.8-1.5% (å¯èƒ½æœ‰ååŒæ•ˆåº”)

---

## ğŸ’¡ æœ€ç»ˆå»ºè®®

### å½“å‰é˜¶æ®µï¼š**ä¸éœ€è¦ç«‹å³è¿›è¡Œæ¨¡å‹æ¶æ„ä¼˜åŒ–**

**ç†ç”±**:

1. **Lossä¼˜åŒ–æ½œåŠ›æœªå……åˆ†æŒ–æ˜**
   - Dice 2.0/2.5å®éªŒå°šæœªå®Œæˆ
   - å†å²æ•°æ®æ˜¾ç¤ºå•å‚æ•°å¯å¸¦æ¥+1%æå‡
   - æˆæœ¬æä½ï¼Œæ”¶ç›Šæ˜ç¡®

2. **å½“å‰æ€§èƒ½å·²æ¥è¿‘ç«äº‰æ°´å¹³**
   - Val 0.6889 â†’ Testé¢„æœŸ0.73-0.74
   - åŠ ä¸ŠDiceä¼˜åŒ–ï¼ŒTestå¯èƒ½è¾¾åˆ°0.74-0.75
   - **è¿™å¯èƒ½å·²ç»è¶³å¤Ÿè¿›å…¥Topæ’å**

3. **æ—¶é—´æˆæœ¬è€ƒè™‘**
   - è·ç¦»æˆªæ­¢æ—¥æœŸ: 5å¤© (10æœˆ14æ—¥)
   - æ¨¡å‹æ¶æ„ä¿®æ”¹éœ€è¦2-3å¤©è°ƒè¯•
   - **ä¼˜å…ˆä¿è¯å®ŒæˆæŠ¥å‘Šå’Œæäº¤**

4. **é£é™©æ§åˆ¶**
   - æ¶æ„æ”¹åŠ¨å¯èƒ½å¼•å…¥æ–°bug
   - è®­ç»ƒä¸ç¨³å®šçš„é£é™©
   - Lossä¼˜åŒ–æ˜¯æœ€ç¨³å¦¥çš„è·¯å¾„

---

## ğŸ“ æ€»ç»“

### å·²çŸ¥æœ€ä½³é…ç½® âœ…

```yaml
model:
  name: microsegformer
  use_lmsa: true
  dropout: 0.15

loss:
  ce_weight: 1.0
  dice_weight: 1.5  # æˆ–å¾…æµ‹è¯•çš„2.0/2.5

training:
  learning_rate: 8e-4
  weight_decay: 1e-4
  scheduler: CosineAnnealingLR
  early_stopping_patience: 100

augmentation:
  rotation: 15  # ä¸è¦è¶…è¿‡15åº¦
  color_jitter: 0.2  # ä¸è¦è¶…è¿‡0.2
```

### å¾…éªŒè¯å‡è®¾ ğŸ”¬

1. **Dice 2.0 > Dice 1.5?** â†’ è®­ç»ƒä¸­
2. **Dice 2.5 > Dice 2.0?** â†’ è®­ç»ƒä¸­
3. **æœ€ä¼˜Dice weightåœ¨2.0-2.5åŒºé—´?** â†’ å¾…ç¡®è®¤

### ä¸‹ä¸€æ­¥è¡ŒåŠ¨ ğŸ“

**ç«‹å³æ‰§è¡Œ**:
1. ç­‰å¾…Dice 2.5/2.0è®­ç»ƒå®Œæˆ
2. åˆ†æç»“æœï¼Œé€‰æ‹©æœ€ä½³æ¨¡å‹
3. æäº¤åˆ°CodabenchéªŒè¯Teståˆ†æ•°

**å¤‡é€‰æ–¹æ¡ˆ**:
- å¦‚æœValè¾¾åˆ°0.70+ï¼Œç›´æ¥æäº¤ï¼Œå‡†å¤‡æŠ¥å‘Š
- å¦‚æœValæœªè¾¾åˆ°0.70ï¼Œè€ƒè™‘Auxiliary Losså¿«é€Ÿä¼˜åŒ–

**ä¸å»ºè®®**:
- âŒ ç°é˜¶æ®µå¤§å¹…ä¿®æ”¹æ¨¡å‹æ¶æ„
- âŒ å°è¯•å…¶ä»–backbone (ResNet/EfficientNet)
- âŒ è¿‡åº¦å¢åŠ æ¨¡å‹å¤æ‚åº¦

---

**æœ€åæ›´æ–°**: 2025-10-09
**ç»“è®º**: **ä¼˜å…ˆå®ŒæˆLosså®éªŒï¼Œæš‚ä¸éœ€è¦æ¨¡å‹æ¶æ„ä¼˜åŒ–**
